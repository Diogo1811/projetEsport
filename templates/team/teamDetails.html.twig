{% extends 'base.html.twig' %}

{% block title %}{{team}}{% endblock %}

{% block body %}

    {% set slideNumber = 0 %}

    <div class="title">

        {# {{ dump(team) }} #}

        <figure id="teamDetailsLogo">

            <img src="{{ asset('upload/logo/' ~ team.logo) }}" alt="logo de {{ team }}">
            
            <figcaption>

                {# The title is the team name #}
                <h1>{{team}}</h1>

            </figcaption>

        </figure>

        {# If the one who is in this page is a registred user he can set a team as is favorite or remove it #}
        {% if is_granted('ROLE_USER') and not is_granted('ROLE_TEAM') or is_granted('ROLE_MODERATOR')%}

            {# We modify the star depending if the user has the team as a favorite or not #}
            {% if app.user.team and app.user.team.id == team.id %}

                {# link to remove team from favorite #}
                <a href= "{{ path('add_team', {'id': team.id}) }}" class="starContainer">

                    <i class='fa-solid fa-star favTeam'></i>

                </a>

            {% else %}

                {# link to add team to favorite #}
                <a href= "{{ path('add_team', {'id': team.id}) }}" class="starContainer">

                    <i class='fa-regular fa-star favTeam'></i>

                </a>

            {% endif %}
            
        {% endif %}
        
    </div>
            
    {# <p>Son siège sociale : <a href="{{ path('details_country', {'id': team.country.id}) }}">{{ team.country }}</a></p> #}

    {# creation date of the team #}
    <p class="creationdate">Date de création : {{ team.creationDate|date_fr('j F Y')}}</p>

    {# <div class="wrapper">
        <div class="container">
            <input type="radio" name="slide" class="rosterRadio" id="c1">
            <label for="c1" class="card">
                <div class="row">
                    <div class="icon">1</div>
                    <div class="description">
                        <h4>Player name</h4>
                        <p>role</p>
                    </div>
                </div>
            </label>
            <input type="radio" name="slide" id="c2">
            <label for="c2" class="card">
                <div class="row">
                    <div class="icon">2</div>
                    <div class="description">
                        <h4>Player name</h4>
                        <p>role</p>
                    </div>
                </div>
            </label>
        </div>
    </div> #}

    {# loop to search every roster  #}
    {% for roster in team.rosters %}
        <h2 class="rosterTitle">Roster actuel pour {{ roster.game }} :</h2>

        <section class="wrapper">

            <article class="container">
    
                {% for playerRoster in roster.playerRosters %}

                    {% set slideNumber = slideNumber + 1 %}
    
                    {% if not playerRoster.playingEndDate %}

                        {% if loop.first %}

                            <input type="radio" name="{{roster.game}}" class="rosterRadio" id="{{playerRoster.id}}" checked>

                        {% else %}

                            <input type="radio" name="{{roster.game}}" class="rosterRadio" id="{{playerRoster.id}}">

                        {% endif %}
                        

                        <label for="{{playerRoster.id}}" class="card" style="background-image: url('{{asset('upload/pictures/' ~ playerRoster.player.picture)}}')">

                            <div class="row">

                                {# <div class="icon">{{slideNumber}}</div> #}

                                <figure class="description">

                                    {# <img src="" alt="Photo de {{playerRoster.player}}"> #}

                                    <figcaption >

                                        <h4><a href="{{ path('details_player', {'id': playerRoster.player.id}) }}">{{playerRoster.player}}</a></h4>

                                        {% if playerRoster.role %}

                                            <p>{{playerRoster.role}}</p>
                                            
                                        {% endif %}

                                    </figcaption>

                                </figure>

                            </div>

                        </label>
    
                    {% endif %}
    
                {% endfor %}

            </article>

        </section>

        {% set oldPlayer = 0 %}

        {% for playerRoster in roster.playerRosters %}

            {% if playerRoster.playingEndDate %}

                {% set oldPlayer = oldPlayer + 1 %}
                
            {% endif %}
            
        {% endfor %}
        {% if oldPlayer > 1 %}

            <h3>Anciens joueurs du roster {{ roster.game }} :</h3>

        {% elseif oldPlayer > 0 %}
            
            <h3>Ancien joueur du roster {{ roster.game }} :</h3>

        {% else %}

        {% endif %}

        <ul>

            {% for playerRoster in roster.playerRosters %}

                {% if playerRoster.playingEndDate %}
                    
                    <li>

                        {{playerRoster.player}} était un joueur {{team}} pour le jeu {{ roster.game }}, il a rejoint l'équipe le {{playerRoster.playingStartDate|date_fr('d F Y')}} et est parti le {{playerRoster.playingEndDate|date_fr('d F Y')}}. {{ playerRoster.role ? "Son rôle était" ~ playerRoster.role }}

                    </li>

                {% endif %}

            {% endfor %}

        </ul>


        <div class="rosterButtons">

            {% if is_granted('ROLE_MODERATOR')%}
    
                {# link to modify a roster #}
                <a href="{{ path('edit_roster', {'idRoster': roster.id, 'id': team.id}) }}" class="btn btn-warning">Modifier un roster</a>
            
            {% endif %}
    
            {% if is_granted('ROLE_ADMIN') %}
                {# Link to delete a roster #}
                <a href="{{ path('delete_roster', {'id': roster.id}) }}" class="btn btn-danger">Supprimer un roster</a>
            
            {% endif %}
        </div>


    {% endfor %}


    {# Allowing modifications only to moderators and admin #}
    {% if is_granted("ROLE_MODERATOR") or is_granted("ROLE_TEAM") and app.user.team and app.user.team.id == team.id %}

        <div class="addRosterOrPlayer">
       
            {# link to add a new roster #}
            <a href="{{ path('new_roster', {'id': team.id}) }}" class="btn btn-success">Ajouter un roster</a>
    
            {# link to add a new player #}
            <a href="{{ path('new_player') }}" class="btn btn-success">Ajouter un joueur</a>

        </div>
        
        <div class="modifyDeleteButton">
            
            {# link to modify a team #}
            <a href="{{ path('edit_team', {'id': team.id}) }}" class="btn btn-warning">Modifier {{ team }}</a>
    
            {% if is_granted("ROLE_ADMIN") %}
                
                {# link to delete a team #}
                <a href="{{ path('delete_team', {'id': team.id}) }}" class="btn btn-danger">Supprimer {{ team }}</a>
            {% endif %}
        </div>
    {% endif %}


{% endblock %}